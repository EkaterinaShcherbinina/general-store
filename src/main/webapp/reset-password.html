<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
<div id="successful-result" style="display:none"> Password is updated</div>
<div id="non-successful-result" style="display:none"> Couldn't update password</div>
<div>
  <h2>Reset Your Password</h2>

  Enter your new password: <input type="password" name="password1" id="password1" required autofocus/></br>
  Confirm your new password: <input type="password" name="password2" id="password2"/></br>
  <input type="button" value="Save new password" onclick="javascript:savePassword()"/>

</div>
</body>
</html>

<script>
  function isEmpty(str) {
    return (!str || 0 === str.trim().length);
  }

  function savePassword() {
    let urlParams = new URLSearchParams(location.search);
    if(!urlParams.has('token') || isEmpty(urlParams.get('token'))) {
      alert("Missing token");
      return;
    }
    let tokenValue = urlParams.get('token');
    let password1 = document.getElementById("password1").value;
    let password2 = document.getElementById("password2").value;

    if(isEmpty(password1) || isEmpty(password2)) {
      alert("Password must not be empty");
      return;
    }
    if(password1 !== password2) {
      alert("Password mismatch");
      return;
    }

    $.ajaxSetup({
        'contentType': 'application/json'
    });
    let data = {
        "token": tokenValue,
        "password": password1
    }

    $.post('http://localhost:8080/reset-password',
            JSON.stringify(data)).done(function (response) {
      document.getElementById("password1").value = "";
      document.getElementById("password2").value = "";
      if(response["result"] === "SUCCESS") {
        $("#non-successful-result").attr("style", "display: none !important;");
        $("#successful-result").attr("style", "display: block !important;");
      } else {
        $("#successful-result").attr("style", "display: none !important;");
        $("#non-successful-result").attr("style", "display: block !important;");
      }
    })
  }
</script>